\documentclass{scrreprt}
\usepackage{listings}
\usepackage{underscore}
\usepackage[bookmarks=true]{hyperref}
\hypersetup{
    bookmarks=false,    % show bookmarks bar?
    pdftitle={Software Requirement Specification},    % title
    pdfauthor={Yiannis Lazarides},                     % author
    pdfsubject={TeX and LaTeX},                        % subject of the document
    pdfkeywords={TeX, LaTeX, graphics, images}, % list of keywords
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=blue,       % color of internal links
    citecolor=black,       % color of links to bibliography
    filecolor=black,        % color of file links
    urlcolor=purple,        % color of external links
    linktoc=page            % only page is linked
}%
\def\myversion{1.0 }
\title{%
\flushright
\rule{16cm}{5pt}\vskip1cm
\Huge{SOFTWARE REQUIREMENTS\\ SPECIFICATION}\\
\vspace{2cm}
for\\
\vspace{1cm}
Dataset implementation in the DIRAC middleware\\
\vspace{1cm}
%\LARGE{Release 1.0\\}
\vspace{2cm}
\LARGE{Implementing dataset operations in the DIRAC middleware based on dataset definition provided by the Auger project group and adding respective commands to the File Catalog CLI.\\}
\vspace{2cm}
by Martin ADAM\\
\vfill
\rule{16cm}{5pt}
}
\date{}
\usepackage{hyperref}
\begin{document}
\maketitle
\tableofcontents
%\chapter*{Revision History}
\chapter{Introduction}
The DIRAC (Distributed Infrastructure with Remote Agent Control) project is a complete Grid solution for a medium sized scientific community. DIRAC forms a layer between users and various compute resources to allow optimized, transparent and reliable usage. The DIRAC architecture consists of numerous cooperating Distributed Services and Light Agents built within the same DISET framework following the Grid security standards. Besides the efficient Workload Management Systems, which introduced the now widely used concept of Pilot Agent, DIRAC also offers a versatile Data Management System (DMS) which is optimized for reliable data transfers. 

The task of this project is to add dataset support to the DIRAC DMS.


\section{Purpose}
Once the dataset features will be implemented in DIRAC, it will have all the functionality to satisfy the needs of the Auger experiment computing model, so Auger will start using DIRAC as it's middleware software solution.


\section{Used Technologies}

\begin{itemize}
\item The main programming language of the DIRAC project is python, so I have to use it for the main part of my work
\item Database functionality relies on MySQL
\item Communication between components is done by the DISET protocol, implementing RPC.
\end{itemize}


\section{References}
\begin{itemize}
\item Dirac official pages (http://diracgrid.org/)
\item Dirac source code repository (https://github.com/DIRACGrid/DIRAC)
\end{itemize}


\section{Definitions}
\begin{description}
\item[Dataset] is a set of files with some common features (files returned by a particular metadata query). In our context, we have frozen and dynamic datasets.
\item[Dynamic dataset] is a set of files, where the files are not bound to the dataset in any way. Thus, when someone removes, changes or deletes a file, the dataset changes without giving any further notice.
\item[Frozen dataset] is a set of files, which are fixed and cannot be changed, unless the dataset is released (melted).
\item[Metadata] is the information describing the user data in order to easily select the file sets of interest for user applications.
\end{description}


\section{Conventions}
This document features some terminology which readers may be unfamiliar with. See Appendix A (Glossary) for a list of these terms and their definitions. 



\chapter{Overall Description}


\section{Product Perspective}
DIRAC components can be grouped in to 5 categories: 
\begin{description}

\item[Commands] \hfill \\
Commands are one of the main interface tools for the users. Usually a command is a script, that contacts the server side, and executes the action it was designed for (e.g. upload file and register it in the File Catalog). Other UI functionality is provided by the web interface.
\item[Services] \hfill \\
Services are the main back-end component. A service provides a layer between the client running a command, and the Databases/Resources it is using. Example of a service is the FileCatalog, or the SystemAdministrator (which provides a server side of the System Administrator CLI, used for managing services running at a particular server).
\item[Databases] \hfill \\
Databases are the MySQL database structures, designed for specific purposes, so that when installing a database for e.g. FileCatalog, you don't have to install one used for e.g. JobLogging.
\item[Agents] \hfill \\
Agents are active software components which run as independent processes to fulfill one or several system functions. Agents are processes that perform actions periodically. Each cycle agents typically contact a service or look into a DB to check for pending actions, execute the required ones and report back the results. 
\item[Executors] \hfill \\
The Executor framework is designed around two components. The Executor Mind knows how to retrieve, store and dispatch tasks. And Executors are the working processes that know what to do depending on the task type. Each Executor is an independent process that connects to the Mind and waits for tasks to be sent to them by the Mind.
\end{description}

The new dataset functionality will be in the DatasetManager extension, associated with the FileCatalog  service. Furthermore, new commands will have to be introduced, most of them will also be installed in the FileCatalog CLI.
%
%\subsection{Commands}
%Commands are one of the main interface tools for the users. Usually a command is a script, that contacts the server side, and executes the action it was designed for (e.g. upload file and register it in the File Catalog). Other UI functionality is provided by the web interface.
%
%\subsection{Services}
%Services are the main back-end component. A service provides a layer between the client running a command, and the Databases/Resources it is using. Example of a service is the FileCatalog, or the SystemAdministrator (which provides a server side of the System Administrator CLI, used for managing services running at a particular server).
%
%\subsection{Databases}
%Databases are the MySQL database structures, designed for specific purposes, so that when installing a database for e.g. FileCatalog, you don't have to install one used for e.g. JobLogging.
%
%\subsection{Agents}
%Agents are active software components which run as independent processes to fulfill one or several system functions. Agents are processes that perform actions periodically. Each cycle agents typically contact a service or look into a DB to check for pending actions, execute the required ones and report back the results. 
%
%\subsection{Executors}
%The Executor framework is designed around two components. The Executor Mind knows how to retrieve, store and dispatch tasks. And Executors are the working processes that know what to do depending on the task type. Each Executor is an independent process that connects to the Mind and waits for tasks to be sent to them by the Mind.


\section{Current Status}

In DIRAC middleware, there already is a very simple DatasetManager. I will revise the work, that was done, and extend it, so that it satisfies the needs of the Auger experiment. Current state will be mentioned in detail in section 3. 


\section{Features}

The required features are:

\begin{enumerate}
\item Adding a dataset.
\item Replicating a dataset.
\item Removing a dataset.
\item Freezing and releasing a dataset.
\item Downloading/replicating a fraction of a dataset.
\item Renaming, moving and copying the dataset object without its files.
\item Adding managing commands (show files, show status,...)
\end{enumerate}


\section{Design and Implementation Constraints}
The task of this work is not to modify any existing FileCatalog functionality other, than the DatasetManager.It can only suggest and test improvements on the MySQL database, that will improve with dataset functionality. The user interface will be focused on the CLI, web interface will not be a part of this work.


\chapter{User Interface}
To work with datasets, user must have the DIRAC client installed. There will be two ways, to access dataset functionality
\begin{itemize}
\item With the FileCatalog CLI
\item With independent commands
\end{itemize}
The focus will be set on interactive behavior, none of the commands shall take more than a few seconds to complete. 


\section{FileCatalog CLI}
There already is a dataset command in the CLI, which behaves according to the first parameter it gets. 

\subsection{dataset add}
\texttt{dataset add <dataset_name> <meta_query>} \\
Make a new dataset from files, returned by the metaquery, or will throw a meaningful error, if it fails.  I will add a \texttt{-f} option, that will instantly freeze the new dataset. This command is already developed, but in need of revision.

\subsection{dataset annotate} 
\texttt{dataset annotate <dataset_name> <annotation>}  \\
Add annotation to a already existing dataset. This command is already developed, but in need of revision.

\subsection{dataset show}
\texttt{dataset show [-l] <dataset_name>} \\
Show existing datasets. The \texttt{-l} option enables long output. This command is already developed.
               
\subsection{dataset status}
\texttt{dataset status <dataset_name>} \\
Display the dataset status. The functionality is similar to \texttt{dataset show -l}, but it shows only information about one dataset. This command is already developed, but in need of revision.

\subsection{dataset files}
\texttt{dataset files <dataset_name>} \\
Show dataset files. This command is already developed, but in need of revision.

\subsection{dataset remove}
\texttt{dataset remove <dataset_name>} \\
Remove dataset. In case of dynamic dataset, the removal will only affect the dataset declaration, not its files. This command is already developed. In case of frozen dataset, the command will have to cross-reference other frozen datasets and the FileCatalog, then remove files owned only by the dataset specified by the second parameter.

\subsection{dataset check}
\texttt{dataset check <dataset_name>} \\
This command is already developed, but deprecated.

\subsection{dataset update}
\texttt{dataset update <dataset_name>} \\
This command is already developed, but deprecated.

\subsection{dataset freeze}
\texttt{dataset freeze <dataset_name>} \\
Change a dynamic dataset into a frozen dataset. This command is already developed, but in need of revision.  

\subsection{dataset release}
\texttt{dataset release <dataset_name>} \\
Change a frozen dataset into a dynamic dataset. This command is already developed, but in need of revision.  

\subsection{dataset replicate}
\texttt{dataset replicate <dataset_name> [-n num] <SE> [<SourceSE>]} \\
Replicate the dataset to a given storage element. If the \texttt{-n} option is specified, the following number will indicate the percentual part of the dataset, that should be replicated.

\subsection{dataset download}
\texttt{dataset download <dataset_name> [-n num]} \\
Downloads the wanted dataset to the users local disk. If the \texttt{-n} option is specified, the following number will indicate the percentual part of the dataset, that should be downloaded.


\section{Independent commands}
Independent command wil take the form of \texttt{dirac-dms-dataset-CMD}, where \texttt{CMD} will be replaced with the first parameter, of the dataset command from the FileCatalog CLI. 

\newpage
%\pagebreak 
\appendix
\chapter*{Appendix A: Glossary} \label{App:AppendixA}
\begin{description}
\item[CLI] \hfill \\
Command Line Interface
\end{description}

\end{document}